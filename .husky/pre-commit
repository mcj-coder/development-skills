# Prevent direct commits to main branch
BRANCH=$(git rev-parse --abbrev-ref HEAD)
if [ "$BRANCH" = "main" ]; then
  echo "‚ùå ERROR: Direct commits to main are not allowed"
  echo "üìã Required workflow:"
  echo "   1. Create feature branch: git checkout -b feat/issue-N-description"
  echo "   2. Commit changes to feature branch"
  echo "   3. Push feature branch: git push -u origin feat/issue-N-description"
  echo "   4. Create PR: gh pr create"
  echo "   5. Merge PR after review"
  echo ""
  echo "‚ÑπÔ∏è  To commit to main (emergency only), use: git commit --no-verify"
  exit 1
fi

# Require GPG commit signing to be configured
if [ "$(git config --get commit.gpgsign)" != "true" ]; then
  echo ""
  echo "‚ùå ERROR: GPG commit signing is not enabled"
  echo "   All commits must be cryptographically signed."
  echo ""
  echo "   To enable signed commits:"
  echo "   1. Follow the setup guide: docs/playbooks/enable-signed-commits.md"
  echo "   2. Configure git: git config --global commit.gpgsign true"
  echo "   3. Ensure your GPG key is added to GitHub"
  echo ""
  echo "‚ÑπÔ∏è  To bypass (not recommended): git commit --no-verify"
  exit 1
fi

npx lint-staged
