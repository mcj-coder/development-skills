# Duplicate Detection Script Implementation Plan

**Issue:** #145
**Date:** 2026-01-08
**Status:** Draft

## Approval History

| Phase         | Reviewer  | Decision | Date | Plan Commit | Comment Link |
| ------------- | --------- | -------- | ---- | ----------- | ------------ |
| Plan Approval | Tech Lead | PENDING  | -    | -           | -            |

## Overview

Create automation to detect potentially duplicate issues when new issues are created.
The workflow searches existing open issues by title keywords and posts a comment
listing potential duplicates to help with early triage.

**Detection Strategy:**

1. Extract significant words from new issue title (ignore common words)
2. Search open issues using GitHub's search API
3. Filter results to exclude the triggering issue
4. Post comment listing potential matches with links

## Scope

### In Scope

- Template GitHub Actions workflow for duplicate detection
- Installed workflow for this repository
- Playbook documenting configuration
- README.md quick reference update
- BDD test file for regression testing

### Out of Scope

- Machine learning similarity scoring
- Body text analysis (title-only for v1)
- Cross-repository duplicate detection
- Automatic closing of duplicates

## Implementation Tasks

### Task 1: Create BDD Test File

Create `skills/issue-driven-delivery/detect-duplicates.test.md` with:

- Baseline scenarios showing pain points without detection
- Assertions for detection behavior
- Test scenarios for duplicate/non-duplicate cases
- Edge cases (no matches, many matches)

**Deliverable:** `skills/issue-driven-delivery/detect-duplicates.test.md`

### Task 2: Create Template Workflow

Create `skills/issue-driven-delivery/templates/detect-duplicates.yml` with:

- Trigger on: `issues.opened`
- Title keyword extraction
- GitHub search API integration
- Comment posting with potential matches
- Configurable exclusion list (common words)

**Deliverable:** `skills/issue-driven-delivery/templates/detect-duplicates.yml`

### Task 3: Install Workflow in Repository

Create `.github/workflows/detect-duplicates.yml` customized for this repository.

**Deliverable:** `.github/workflows/detect-duplicates.yml`

### Task 4: Create Playbook

Create `docs/playbooks/duplicate-detection.md` with:

- Overview and purpose
- How detection works
- Configuration options
- Interpreting results
- Troubleshooting guide

**Deliverable:** `docs/playbooks/duplicate-detection.md`

### Task 5: Update README.md

Add quick reference in Automation section.

**Deliverable:** Updated README.md

### Task 6: Run Linting Validation

1. Run `npm run lint` to validate all files
2. Fix any formatting issues

**Deliverable:** Clean lint output

## Technical Approach

### Keyword Extraction

Extract significant words from the issue title by:

1. Convert to lowercase
2. Remove common stop words (a, an, the, is, to, for, etc.)
3. Remove short words (< 3 characters)
4. Use remaining words for search

**Stop Words List (configurable):**

```text
a an the is are was were be been being have has had do does did will would
could should may might must shall can for to of in on at by with from as or
and but not this that these those it its
```

### Search Strategy

Use GitHub's search API via `gh` CLI:

```bash
# Build search query from keywords
SEARCH_TERMS="keyword1 keyword2 keyword3"
gh issue list --search "$SEARCH_TERMS in:title is:open" --json number,title,url
```

**Filtering:**

- Exclude the triggering issue (by number)
- Limit results to top 5 matches
- Only show issues with meaningful overlap (not single-word matches)

### Comment Format

```markdown
## Potential Duplicates Detected

The following open issues may be related to this one:

| Issue | Title                 |
| ----- | --------------------- |
| #123  | Similar issue title   |
| #456  | Another similar title |

Please review these issues. If this is a duplicate, consider:

- Closing this issue as duplicate of #123
- Linking issues if they are related but distinct

---

_This comment was automatically generated by the duplicate detection workflow._
```

### Edge Cases

- No matches found: No comment posted
- Many matches (>5): Truncate to top 5 with note
- Very short titles: Skip detection (< 3 significant words)
- Issue body mentions duplicates: May enhance detection in future

## Acceptance Criteria Mapping

| Acceptance Criteria                                   | Task   |
| ----------------------------------------------------- | ------ |
| Template workflow in skill's `templates/` folder      | Task 2 |
| Customized workflow installed in `.github/workflows/` | Task 3 |
| Workflow triggers on new issue creation               | Task 3 |
| Comment posted with potential duplicates              | Task 2 |
| No false positives for clearly different issues       | Task 2 |
| README.md updated with quick reference                | Task 5 |
| `docs/playbooks/duplicate-detection.md` created       | Task 4 |
| All linting passes (`npm run lint`)                   | Task 6 |

## BDD Verification Checklist

### Task 1: BDD Test File

- [ ] File exists at `skills/issue-driven-delivery/detect-duplicates.test.md`
- [ ] Contains baseline scenarios
- [ ] Contains assertions for detection behavior
- [ ] Contains test scenarios with verification steps

### Task 2: Template Workflow

- [ ] File exists at `skills/issue-driven-delivery/templates/detect-duplicates.yml`
- [ ] YAML is valid (no syntax errors)
- [ ] Contains trigger for issues.opened
- [ ] Contains keyword extraction logic
- [ ] Contains search and comment logic

### Task 3: Installed Workflow

- [ ] File exists at `.github/workflows/detect-duplicates.yml`
- [ ] Workflow validates successfully
- [ ] Posts comment when duplicates found
- [ ] Does not post when no duplicates

### Task 4: Playbook

- [ ] File exists at `docs/playbooks/duplicate-detection.md`
- [ ] Has valid frontmatter
- [ ] Documents detection logic
- [ ] Contains troubleshooting section

### Task 5: README Update

- [ ] README.md references detect-duplicates workflow
- [ ] Quick reference is in Automation section

### Task 6: Validation

- [ ] `npm run lint` passes with no errors

## Review Personas

| Phase          | Reviewers                         | Focus                |
| -------------- | --------------------------------- | -------------------- |
| Refinement     | Tech Lead, Documentation Spec     | Plan completeness    |
| Implementation | DevOps Engineer, Senior Developer | Workflow correctness |
| Approval       | Tech Lead                         | Strategic alignment  |

## Evidence Requirements

**Task 1:** Commit SHA, file link to test file
**Task 2:** Commit SHA, file link to template
**Task 3:** Commit SHA, file link, test run with duplicate detection
**Task 4:** Commit SHA, file link to playbook
**Task 5:** Commit SHA, diff showing README update
**Task 6:** Lint output showing clean build

## Review History

_No reviews yet._
